<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Optimización de Videos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
</head>

<body class="p-4">
  <div class="container">
    <h1 class="mb-4">Historial de Optimización</h1>
    <div class="mb-3">
      <form method="post" action="/manual_scan" style="display:inline;">
        <button type="submit" class="btn btn-primary">Forzar Escaneo</button>
      </form>
      <form method="post" action="/delete_stats" style="display:inline;">
        <button type="submit" class="btn btn-danger">Eliminar estadísticas</button>
      </form>
    </div>
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>Archivo</th>
          <th>Original</th>
          <th>Optimizado</th>
          <th>Reducción (%)</th>
        </tr>
      </thead>
      <tbody>

        <div id="processing" class="mb-3">
          <h5>Procesando actualmente:</h5>
          <ul id="processing-list" class="list-group"></ul>
        </div>

        {% for row in data %}
        <tr>
          <td>{{ row[0] }}</td> {# nombre de archivo #}
          <td>{{ row[1] }}</td> {# tamaño original #}
          <td>{{ row[2] }}</td> {# tamaño optimizado #}
          {% if row[4] %}
          <td style="background-color: #dc3545; color: white; font-weight:bold;">Falló</td>
          {% else %}
          <td style="background-color: {{ row[5] }}; color: white; font-weight:bold;">
            {{ row[3] }}%
          </td>
          {% endif %}
        </tr>
        {% endfor %}

      </tbody>

      <tfoot class="table-light">
        <tr>
          <th>Total</th>
          <th>{{ total_orig }}</th>
          <th>{{ total_opt }}</th>
          <th></th>
        </tr>
      </tfoot>

    </table>
  </div>
</body>

<div hidden>
  <li id="item-processing-template" class="list-group-item d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center gap-2">
      <span class="spinner-border spinner-border-sm text-primary" role="status" aria-hidden="true"></span>
      <span class="processing-filename">%text%</span>
    </div>
    <div class="progress w-50" style="height: 20px;">
      <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: %progress%%; font-weight: bold;" aria-valuenow="%progress%" aria-valuemin="0" aria-valuemax="100">
        %progress%%
      </div>
    </div>
  </li>
</div>

<script src="static/script.js"></script>

</html>